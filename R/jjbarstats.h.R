
# This file is automatically generated, you probably don't want to edit this

jjbarstatsOptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "jjbarstatsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            dep = NULL,
            group = NULL,
            grvar = NULL,
            counts = NULL,
            direction = "independent",
            excl = TRUE,
            ratio = "",
            sample.size.label = TRUE,
            label = "percentage",
            perc.k = 0,
            bf.message = TRUE,
            sampling.plan = "indepMulti",
            fixed.margin = "rows",
            title = "",
            results.subtitle = TRUE,
            subtitle = "",
            caption = "",
            conf.level = 0.95, ...) {

            super$initialize(
                package='ClinicoPath',
                name='jjbarstats',
                requiresData=TRUE,
                ...)

            private$..dep <- jmvcore::OptionVariables$new(
                "dep",
                dep,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..group <- jmvcore::OptionVariable$new(
                "group",
                group,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..grvar <- jmvcore::OptionVariable$new(
                "grvar",
                grvar,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..counts <- jmvcore::OptionVariable$new(
                "counts",
                counts,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..direction <- jmvcore::OptionList$new(
                "direction",
                direction,
                options=list(
                    "repeated",
                    "independent"),
                default="independent")
            private$..excl <- jmvcore::OptionBool$new(
                "excl",
                excl,
                default=TRUE)
            private$..ratio <- jmvcore::OptionString$new(
                "ratio",
                ratio,
                default="")
            private$..sample.size.label <- jmvcore::OptionBool$new(
                "sample.size.label",
                sample.size.label,
                default=TRUE)
            private$..label <- jmvcore::OptionList$new(
                "label",
                label,
                options=list(
                    "percentage",
                    "counts",
                    "both"),
                default="percentage")
            private$..perc.k <- jmvcore::OptionInteger$new(
                "perc.k",
                perc.k,
                default=0)
            private$..bf.message <- jmvcore::OptionBool$new(
                "bf.message",
                bf.message,
                default=TRUE)
            private$..sampling.plan <- jmvcore::OptionList$new(
                "sampling.plan",
                sampling.plan,
                options=list(
                    "indepMulti",
                    "poisson",
                    "jointMulti",
                    "hypergeom"),
                default="indepMulti")
            private$..fixed.margin <- jmvcore::OptionList$new(
                "fixed.margin",
                fixed.margin,
                options=list(
                    "rows",
                    "cols"),
                default="rows")
            private$..title <- jmvcore::OptionString$new(
                "title",
                title,
                default="")
            private$..results.subtitle <- jmvcore::OptionBool$new(
                "results.subtitle",
                results.subtitle,
                default=TRUE)
            private$..subtitle <- jmvcore::OptionString$new(
                "subtitle",
                subtitle,
                default="")
            private$..caption <- jmvcore::OptionString$new(
                "caption",
                caption,
                default="")
            private$..conf.level <- jmvcore::OptionNumber$new(
                "conf.level",
                conf.level,
                default=0.95,
                min=0,
                max=1)

            self$.addOption(private$..dep)
            self$.addOption(private$..group)
            self$.addOption(private$..grvar)
            self$.addOption(private$..counts)
            self$.addOption(private$..direction)
            self$.addOption(private$..excl)
            self$.addOption(private$..ratio)
            self$.addOption(private$..sample.size.label)
            self$.addOption(private$..label)
            self$.addOption(private$..perc.k)
            self$.addOption(private$..bf.message)
            self$.addOption(private$..sampling.plan)
            self$.addOption(private$..fixed.margin)
            self$.addOption(private$..title)
            self$.addOption(private$..results.subtitle)
            self$.addOption(private$..subtitle)
            self$.addOption(private$..caption)
            self$.addOption(private$..conf.level)
        }),
    active = list(
        dep = function() private$..dep$value,
        group = function() private$..group$value,
        grvar = function() private$..grvar$value,
        counts = function() private$..counts$value,
        direction = function() private$..direction$value,
        excl = function() private$..excl$value,
        ratio = function() private$..ratio$value,
        sample.size.label = function() private$..sample.size.label$value,
        label = function() private$..label$value,
        perc.k = function() private$..perc.k$value,
        bf.message = function() private$..bf.message$value,
        sampling.plan = function() private$..sampling.plan$value,
        fixed.margin = function() private$..fixed.margin$value,
        title = function() private$..title$value,
        results.subtitle = function() private$..results.subtitle$value,
        subtitle = function() private$..subtitle$value,
        caption = function() private$..caption$value,
        conf.level = function() private$..conf.level$value),
    private = list(
        ..dep = NA,
        ..group = NA,
        ..grvar = NA,
        ..counts = NA,
        ..direction = NA,
        ..excl = NA,
        ..ratio = NA,
        ..sample.size.label = NA,
        ..label = NA,
        ..perc.k = NA,
        ..bf.message = NA,
        ..sampling.plan = NA,
        ..fixed.margin = NA,
        ..title = NA,
        ..results.subtitle = NA,
        ..subtitle = NA,
        ..caption = NA,
        ..conf.level = NA)
)

jjbarstatsResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Bar Charts",
                refs=list(
                    "ggplot2",
                    "ggstatsplot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="To Do",
                clearWith=list(
                    "dep",
                    "group",
                    "grvar",
                    "direction")))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Bar Chart",
                width=800,
                height=600,
                renderFun=".plot",
                requiresData=TRUE,
                clearWith=list(
                    "dep",
                    "group",
                    "grvar",
                    "direction")))}))

jjbarstatsBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "jjbarstatsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'ClinicoPath',
                name = 'jjbarstats',
                version = c(1,0,0),
                options = options,
                results = jjbarstatsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Bar Charts
#'
#' 'Wrapper Function for ggstatsplot::ggbarstats and
#' ggstatsplot::grouped_ggbarstats to generate Bar Charts.'
#' 
#'
#' @examples
#' \dontrun{
#' # example will be added
#'}
#' @param data The data as a data frame.
#' @param dep .
#' @param group .
#' @param grvar .
#' @param counts .
#' @param direction select measurement type (repeated or independent)
#' @param excl .
#' @param ratio .
#' @param sample.size.label .
#' @param label label
#' @param perc.k .
#' @param bf.message .
#' @param sampling.plan sampling.plan
#' @param fixed.margin fixed.margin
#' @param title .
#' @param results.subtitle .
#' @param subtitle .
#' @param caption .
#' @param conf.level .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' @export
jjbarstats <- function(
    data,
    dep,
    group,
    grvar,
    counts,
    direction = "independent",
    excl = TRUE,
    ratio = "",
    sample.size.label = TRUE,
    label = "percentage",
    perc.k = 0,
    bf.message = TRUE,
    sampling.plan = "indepMulti",
    fixed.margin = "rows",
    title = "",
    results.subtitle = TRUE,
    subtitle = "",
    caption = "",
    conf.level = 0.95) {

    if ( ! requireNamespace('jmvcore'))
        stop('jjbarstats requires jmvcore to be installed (restart may be required)')

    if ( ! missing(dep)) dep <- jmvcore::resolveQuo(jmvcore::enquo(dep))
    if ( ! missing(group)) group <- jmvcore::resolveQuo(jmvcore::enquo(group))
    if ( ! missing(grvar)) grvar <- jmvcore::resolveQuo(jmvcore::enquo(grvar))
    if ( ! missing(counts)) counts <- jmvcore::resolveQuo(jmvcore::enquo(counts))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dep), dep, NULL),
            `if`( ! missing(group), group, NULL),
            `if`( ! missing(grvar), grvar, NULL),
            `if`( ! missing(counts), counts, NULL))

    for (v in dep) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in group) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in grvar) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jjbarstatsOptions$new(
        dep = dep,
        group = group,
        grvar = grvar,
        counts = counts,
        direction = direction,
        excl = excl,
        ratio = ratio,
        sample.size.label = sample.size.label,
        label = label,
        perc.k = perc.k,
        bf.message = bf.message,
        sampling.plan = sampling.plan,
        fixed.margin = fixed.margin,
        title = title,
        results.subtitle = results.subtitle,
        subtitle = subtitle,
        caption = caption,
        conf.level = conf.level)

    analysis <- jjbarstatsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
